{% extends "base.html" %}

{% block title %}Home - Flight Reservation System{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <!-- Floating Airplane Animation -->
    <div class="floating-plane">
        <i class="bi bi-airplane-fill"></i>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="display-4 fw-bold text-white mb-3 animate-fade-in">
                    <i class="bi bi-airplane-engines"></i>
                    Find Your Perfect Flight
                </h1>
                <p class="lead text-white-50 mb-5 animate-fade-in-delay">
                    Search and book flights to your favorite destinations
                </p>

                <!-- Search Form -->
                <div class="search-card">
                    <form id="searchForm" class="row g-3">
                        <div class="col-md-4">
                            <label for="source" class="form-label">
                                <i class="bi bi-geo-alt-fill me-1"></i>From
                            </label>
                            <input type="text" class="form-control form-control-lg" id="source"
                                placeholder="e.g., Delhi" required>
                        </div>
                        <div class="col-md-4">
                            <label for="destination" class="form-label">
                                <i class="bi bi-geo-fill me-1"></i>To
                            </label>
                            <input type="text" class="form-control form-control-lg" id="destination"
                                placeholder="e.g., Mumbai" required>
                        </div>
                        <div class="col-md-4">
                            <label for="date" class="form-label">
                                <i class="bi bi-calendar-fill me-1"></i>Date
                            </label>
                            <input type="date" class="form-control form-control-lg" id="date" required>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary btn-lg px-5 pulse-button">
                                <i class="bi bi-search me-2"></i>Search Flights
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filters Section -->
<div class="container my-4" id="filtersSection" style="display: none;">
    <div class="filters-card">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label fw-bold">
                    <i class="bi bi-cash-stack me-1"></i>Price Range
                </label>
                <div class="row g-2">
                    <div class="col-6">
                        <input type="number" class="form-control" id="minPrice" placeholder="Min ₹" value="0">
                    </div>
                    <div class="col-6">
                        <input type="number" class="form-control" id="maxPrice" placeholder="Max ₹" value="20000">
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">
                    <i class="bi bi-clock me-1"></i>Time of Day
                </label>
                <select class="form-select" id="timeFilter">
                    <option value="all">All Times</option>
                    <option value="morning">Morning (6AM-12PM)</option>
                    <option value="afternoon">Afternoon (12PM-6PM)</option>
                    <option value="evening">Evening (6PM-12AM)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold">
                    <i class="bi bi-sort-down me-1"></i>Sort By
                </label>
                <select class="form-select" id="sortFilter">
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="time-asc">Earliest First</option>
                    <option value="time-desc">Latest First</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" onclick="applyFilters()">
                    <i class="bi bi-funnel me-1"></i>Apply
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Search Results Section -->
<div class="container my-5">
    <div id="resultsSection" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="bi bi-list-ul me-2"></i>Available Flights
                <span class="badge bg-primary" id="flightCount">0</span>
            </h2>
        </div>
        <div id="flightResults" class="row g-4">
            <!-- Flight cards will be inserted here -->
        </div>
    </div>

    <div id="noResults" style="display: none;" class="text-center py-5">
        <i class="bi bi-exclamation-circle text-muted" style="font-size: 4rem;"></i>
        <h3 class="mt-3 text-muted">No flights found</h3>
        <p class="text-muted">Try searching with different criteria</p>
    </div>

    <div id="loadingSpinner" style="display: none;" class="text-center py-5">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Searching for flights...</p>
    </div>
</div>

<!-- Features Section -->
<div class="container my-5 py-5">
    <div class="row text-center g-4">
        <div class="col-md-4">
            <div class="feature-card">
                <i class="bi bi-lightning-charge-fill feature-icon"></i>
                <h4 class="mt-3">Quick Booking</h4>
                <p class="text-muted">Book your flights in just a few clicks</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card">
                <i class="bi bi-shield-check feature-icon"></i>
                <h4 class="mt-3">Secure & Safe</h4>
                <p class="text-muted">Your data is protected with us</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card">
                <i class="bi bi-headset feature-icon"></i>
                <h4 class="mt-3">24/7 Support</h4>
                <p class="text-muted">We're here to help anytime</p>
            </div>
        </div>
    </div>
</div>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-ticket-fill me-2"></i>Book Flight
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div id="bookingWizard" class="p-3">

                    <!-- Step 1: Class Selection -->
                    <div id="step-class" class="wizard-step animate-fade-in">
                        <h5 class="text-center mb-4 text-dark fw-bold">Select Travel Class</h5>
                        <div class="row g-3" id="classOptions">
                            <!-- Injected JS -->
                        </div>
                    </div>

                    <!-- Step 2: Seat Selection -->
                    <div id="step-seat" class="wizard-step animate-fade-in" style="display:none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold mb-0">Select Seat</h5>
                            <span id="selectedClassDisplay" class="badge bg-secondary"></span>
                        </div>

                        <div class="card bg-light border-0 mb-3">
                            <div class="card-body py-2">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h6 class="mb-0">Group Booking</h6>
                                        <small class="text-muted">Select up to 10 seats</small>
                                    </div>
                                    <div class="form-check form-switch fs-4 m-0">
                                        <input class="form-check-input" type="checkbox" id="groupBookingToggle"
                                            onchange="toggleGroupBooking()">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-center mb-3 text-muted small">
                            <div class="d-flex align-items-center me-3">
                                <div class="seat me-1" style="width:20px;height:20px;"></div> Available
                            </div>
                            <div class="d-flex align-items-center me-3">
                                <div class="seat selected me-1" style="width:20px;height:20px;"></div> Selected
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="seat occupied me-1" style="width:20px;height:20px;"></div> Occupied
                            </div>
                        </div>

                        <div class="seat-map-container overflow-auto mb-4" style="height: 350px;">
                            <div class="seat-grid" id="seatGrid"></div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded">
                            <div>
                                <small class="text-muted d-block">Selected Seats</small>
                                <div id="selectedSeatsDisplay" class="fw-bold text-primary fs-5">-</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary" onclick="switchStep('class')">Back</button>
                                <button class="btn btn-primary px-4" onclick="switchStep('passenger')"
                                    id="btnConfirmSeat" disabled>
                                    Continue <i class="bi bi-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Step 3: Passenger Details & Payment -->
                    <div id="step-passenger" class="wizard-step" style="display: none;">
                        <div class="d-flex align-items-center mb-4">
                            <button class="btn btn-link text-decoration-none p-0 me-3" onclick="switchStep('seat')">
                                <i class="bi bi-arrow-left fs-4"></i>
                            </button>
                            <h5 class="mb-0">Passenger Details</h5>
                        </div>

                        <div id="passengerInputsContainer">
                            <!-- Dynamic inputs will be generated here -->
                        </div>

                        <hr class="my-4">

                        <h6 class="mb-3">Payment Summary</h6>
                        <div class="card bg-light border-0 mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Flight</span>
                                    <strong id="finalFlightInfo"></strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Class</span>
                                    <strong id="finalClass"></strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Seat(s)</span>
                                    <strong id="finalSeat"></strong>
                                </div>
                                <div class="border-top pt-2 d-flex justify-content-between fs-5 fw-bold text-primary">
                                    <span>Total</span>
                                    <span id="finalPrice"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Card Details (Simulated)</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-credit-card"></i></span>
                                <input type="text" class="form-control" placeholder="0000 0000 0000 0000">
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button class="btn btn-light flex-grow-1" onclick="switchStep('seat')">Back</button>
                            <button class="btn btn-success flex-grow-1 btn-lg" onclick="processBooking()">
                                <i class="bi bi-lock-fill me-2"></i>Pay Securely
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Success -->
                    <div id="step-success" class="wizard-step animate-fade-in text-center py-5" style="display:none;">
                        <div class="spinner-border text-success mb-3" style="width: 3rem; height: 3rem;" role="status">
                        </div>
                        <h5>Processing Payment...</h5>
                        <p class="text-muted">Please do not close this window.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Set minimum date to today
    const dateInput = document.getElementById('date');
    if (dateInput) {
        dateInput.min = new Date().toISOString().split('T')[0];
    }

    // Search form submission
    const searchForm = document.getElementById('searchForm');
    if (searchForm) {
        searchForm.addEventListener('submit', function (e) {
            e.preventDefault();
            searchFlights();
        });
    }
</script>
{% endblock %}